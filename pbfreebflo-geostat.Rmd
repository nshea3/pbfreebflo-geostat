---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}

library(leaflet)

leadbflo_data = read.csv("data/buffalo_lead.csv", header=TRUE)


leaflet(leadbflo_data) %>% addProviderTiles(providers$CartoDB.Positron) %>% addCircles(color = ~lead_ppb, lng = ~longitude, lat = ~latitude)

```
```{r}
library(rgdal)
library(sp)
xy <- leadbflo_data[7:8]
data <- leadbflo_data[-7:-8]
bflopb_spatial <- SpatialPointsDataFrame(coords=xy, data=data)
proj4string(bflopb_spatial) <- CRS("+init=epsg:3857")
bubble(bflopb_spatial, "lead_ppb")
```
```{r}
boxplot(lead_ppb ~ zipcode, leadbflo_data)
```

First attempts at geostatistical analysis:

```{r}
library(gstat)

v = variogram(lead_ppb ~ 1, bflopb_spatial)

fit.variogram(v, vgm(c("Exp", "Mat", "Sph")))

TheVariogramModel <- vgm(psill=29.89239, model="Sph", nugget=0.0001, range=0.01814742)
plot(v, model=TheVariogramModel)
```


Sources:

http://gsp.humboldt.edu/OLM/R/04_01_Variograms.html
https://www.r-spatial.org/r/2016/02/14/gstat-variogram-fitting.html
